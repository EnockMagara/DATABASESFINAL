<h1>View Analytics</h1>

<!-- Section to view frequent customer -->
<h2>Frequent Customer</h2>
<button id="frequentCustomerButton">View Frequent Customer</button>
<div id="frequentCustomerResult"></div>

<!-- Section to view customer flights -->
<h2>Customer Flights</h2>
<form id="customerFlightsForm">
    <label for="customer_email">Customer Email:</label>
    <input type="email" id="customer_email" name="email" required>
    <button type="submit">View Flights</button>
</form>
<div id="customerFlightsResult"></div>

<script>
// AJAX for viewing frequent customer
document.getElementById('frequentCustomerButton').addEventListener('click', function() {
    fetch('/staff/frequent-customer', {
        method: 'GET' // Use GET method to fetch data
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok'); // Throw an error if response is not ok
        }
        return response.json(); // Parse the response as JSON
    })
    .then(data => {
        if (data.email && data.ticket_count !== undefined) {
            // Display the frequent customer data if present in the response
            document.getElementById('frequentCustomerResult').innerText = `${data.email} - ${data.ticket_count} tickets`;
        } else {
            // Handle case where expected data is not present in the response
            document.getElementById('frequentCustomerResult').innerText = 'Unexpected response format';
        }
    })
    .catch(error => {
        // Log the error and display a user-friendly message
        console.error('Error:', error);
        document.getElementById('frequentCustomerResult').innerText = 'An error occurred while fetching frequent customer data';
    });
});

// AJAX for viewing customer flights
document.getElementById('customerFlightsForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the default form submission
    const formData = new FormData(this); // Create a FormData object from the form
    const email = document.getElementById('customer_email').value; // Get the email value from the input
    fetch(`/staff/customer-flights/${email}`, {
        method: 'GET' // Use GET method to fetch data
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok'); // Throw an error if response is not ok
        }
        return response.json(); // Parse the response as JSON
    })
    .then(data => {
        const resultDiv = document.getElementById('customerFlightsResult');
        if (Array.isArray(data) && data.length > 0) {
            // Display the flights data if present in the response
            resultDiv.innerHTML = data.map(flight => `<p>${flight.flight_number} - ${flight.departure_airport} to ${flight.arrival_airport} on ${flight.departure_datetime}</p>`).join('');
        } else {
            // Handle case where no flights are found or unexpected response format
            resultDiv.innerText = 'No flights found or unexpected response format';
        }
    })
    .catch(error => {
        // Log the error and display a user-friendly message
        console.error('Error:', error);
        document.getElementById('customerFlightsResult').innerText = 'An error occurred while fetching customer flights';
    });
});
</script>
