<h2>Search Flights</h2>
<form id="searchFlightsForm">
    <label for="source">Source:</label>
    <input type="text" id="source" name="source" required>

    <label for="destination">Destination:</label>
    <input type="text" id="destination" name="destination" required>

    <label for="departureDate">Departure Date:</label>
    <input type="date" id="departureDate" name="departureDate" required>

    <label for="returnDate">Return Date (optional):</label>
    <input type="date" id="returnDate" name="returnDate">

    <button type="submit">Search</button>
</form>

<div id="flightsResults"></div>

<script>
document.getElementById('searchFlightsForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the default form submission
    const formData = new FormData(this); // Create a FormData object from the form
    fetch('/customer/search-flights?' + new URLSearchParams(formData), {
        method: 'GET' // Use GET method to fetch data
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok'); // Throw an error if response is not ok
        }
        return response.json(); // Parse the response as JSON
    })
    .then(data => {
        const resultsDiv = document.getElementById('flightsResults');
        if (data.flights && Array.isArray(data.flights)) {
            // Check if flights data is present and is an array
            if (data.flights.length > 0) {
                // If there are flights, display them
                resultsDiv.innerHTML = data.flights.map(flight => 
                    `<p>${flight.airline_name} - ${flight.flight_number} from ${flight.departure_airport_name} to ${flight.arrival_airport_name} on ${flight.departure_datetime}</p>`
                ).join('');
            } else {
                // If no flights are found, display a message
                resultsDiv.innerText = 'No flights found for the given criteria.';
            }
        } else {
            // Handle unexpected response format
            resultsDiv.innerText = 'Unexpected response format';
        }
    })
    .catch(error => {
        // Log the error and display a user-friendly message
        console.error('Error:', error);
        document.getElementById('flightsResults').innerText = 'An error occurred while searching for flights';
    });
});
</script>
